# Creating a new v3 EA

This guide outlines the steps needed to setup a basic adapter.

The v3 framework currently only supports development of source adapters (adapters that only connect to one data provider). This guide will assume the adapter is being created in the [External Adapters Monorepo](https://github.com/smartcontractkit/external-adapters-js) under `packages/sources/`.

## Steps

1. [Create the Folder Structure](#create-the-folder-structure)
2. [Create a Transport](#create-a-transport)
3. [Create an Endpoint](#create-an-endpoint)
4. [Create the Adapter](#create-the-adapter)

## Create the Folder Structure

An adapter built with the v3 framework has the following folder structure.

This structure is a standard we want to keep for consistency in the monorepo but it is not strictly required as it was in v2.

```
adapter // Name after the adapter
├─ config
│  ├─ index.ts // Custom settings. Optional but very common
│  ├─ overrides.json // Overrides file. Optional
|  └─ includes.json // Includes file (e.x. inverses). Optional
├─ endpoints
│  └─ endpoint.ts // Endpoint and Transport defined here. Name after API endpoint
├─ index.ts // Adapter defined here
├─ test
├─ package.json
├─ CHANGELOG.md // Content auto-updated through changesets
├─ README.md // Content auto-generated by CI scripts
├─ test-payload.json
├─ tsconfig.json
└─ tsconfig.test.json
```

## Create a Transport

Once the folder structure has been set up, a transport can be defined in its respective endpoint file. The v3 framework provides different types of transports to allow data retrieval through different protocols, such as HTTP, Websocket, and SSE.

To learn more about transports and their specifications, please refer to the [Transports Guide](./v3-ea-components/transports.md).

For the purpose of this guide, an example HTTP transport is shown below.

```typescript
const transport = new HttpTransport<EndpointTypes>({
  // Return list of ProviderRequestConfigs
  prepareRequests: (params, config) => {
    return params.map((param) => {
      const symbol = param.symbol.toLowerCase()
      const url = `/price/${symbol}`

      return {
        params: param
        request: {
          baseURL: config.API_ENDPOINT,
          url,
        },
      }
    })
  },
  // Parse response into individual ProviderResults for each set of params
  parseResponse: (params, res) => {
    return res.data.map((result) => {
      return {
        params: { symbol: result.symbol},
        response: {
          data: {
            result: result.price,
          },
          result: result.price,
        },
      }
    })
  },
})
```

## Create an Endpoint

The endpoint can be defined referring to the transport created in the previous step as shown in the example below.

To learn more about `AdapterEndpoint` and its parameters, please refer to the [Endpoints Guide](./v3-ea-components/endpoints.md).

```typescript
import { AdapterEndpoint } from '@chainlink/external-adapter-framework/adapter'

export const endpoint = new AdapterEndpoint<EndpointTypes>({
  name: 'endpoint', // The name of this endpoint
  transport: transport, // The transport this endpoint is retrieves data through
  inputParameters, // Input parameters sent in requests to this endpoint
})
```

## Create the Adapter

Finally, create the adapter in the root-level `index.ts` file. Reference the endpoint created in the previous step as shown in the example below.

To learn more about `Adapter` and its parameters, please refer to the [Adapter Guide](./v3-ea-components/adapter.md).

```typescript
import { expose } from '@chainlink/external-adapter-framework'
import { endpoint } from './endpoint'

export const adapter = new Adapter({
  name: 'ADAPTER_NAME', // The EA name, in uppercase without any spaces
  endpoints: [endpoint], // An array of all endpoints available. Defined in the endpoints folder
})

// Expose the server to start the EA
export const server = () => expose(adapter)
```
